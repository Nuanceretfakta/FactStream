# Day 45 ‚Äì refactoring the decision engine (vibe coding)

from typing import Dict, List, Tuple


def normalize(text: str) -> str:
    return (text or "").strip()


def description_is_unclear(text: str) -> bool:
    """
    Simple heuristic for unclear descriptions.
    """
    t = normalize(text).lower()
    too_short = len(t) < 15
    too_generic = t in {"hj√¶lp", "help", "ved ikke", "ok", "problem", "fejl", "virker ikke"}
    return too_short or too_generic


def decision_and_reason(case: Dict) -> Tuple[str, str]:
    """
    Returns decision (AUTO/MANUEL) and a short reason.
    Same rules as Day 44 ‚Äì cleaner structure.
    """
    priority = normalize(case.get("prioritet", "Middel")).capitalize()
    description = normalize(case.get("beskrivelse", ""))
    email = normalize(case.get("email", ""))

    manual_reasons = []

    if priority == "H√∏j":
        manual_reasons.append("h√∏j prioritet")

    if description_is_unclear(description):
        manual_reasons.append("uklar beskrivelse")

    if not email:
        manual_reasons.append("mangler email")

    if manual_reasons:
        return "MANUEL", ", ".join(manual_reasons)

    return "AUTO", "klar sag uden h√∏j prioritet"


def main() -> None:
    cases: List[Dict] = [
        {
            "navn": "Anna",
            "prioritet": "Lav",
            "email": "anna@firma.dk",
            "beskrivelse": "Jeg vil gerne √¶ndre l√∏ntr√¶kprocent ‚Äì hvordan g√∏r jeg?",
        },
        {
            "navn": "Jonas",
            "prioritet": "H√∏j",
            "email": "jonas@firma.dk",
            "beskrivelse": "Systemet fejler ved login med MitID (fejlkode 401).",
        },
        {
            "navn": "Mads",
            "prioritet": "Middel",
            "email": "mads@firma.dk",
            "beskrivelse": "Hj√¶lp",
        },
        {
            "navn": "Sara",
            "prioritet": "Middel",
            "email": "",
            "beskrivelse": "Kan ikke f√• adgang til delte mapper i SharePoint.",
        },
    ]

    print("\nü§ñ Dag 45 ‚Äì Beslutningsmotor (refaktoreret)\n")

    for index, case in enumerate(cases, start=1):
        decision, reason = decision_and_reason(case)
        print(f"Sag {index}: {decision} ‚Äî {reason}")

    print()


if __name__ == "__main__":
    main()
