"""
Product core â€“ logical contract (input -> output)

Purpose:
Define and execute the first decision rule in the product.
The contract stays stable while rules can evolve.
"""

from typing import TypedDict, Literal


# -------------------------
# INPUT CONTRACT
# -------------------------

class CaseInput(TypedDict, total=False):
    type: Literal["intern", "ekstern"]
    afdeling: str
    prioritet: Literal["Lav", "Middel", "HÃ¸j"]
    beskrivelse: str
    navn: str
    email: str
    source: str


# -------------------------
# OUTPUT CONTRACT
# -------------------------

DecisionType = Literal["AUTO", "MANUEL"]


class DecisionOutput(TypedDict):
    decision: DecisionType
    reason: str


# -------------------------
# CORE FUNCTION (v2 â€“ first rule)
# -------------------------

def decide(case: CaseInput) -> DecisionOutput:
    """
    First decision rule (v2):

    Rule:
    - If prioritet is 'HÃ¸j' â†’ MANUEL
    - Else â†’ AUTO

    This is intentionally simple.
    """

    prioritet = case.get("prioritet", "Middel")

    if prioritet == "HÃ¸j":
        return {
            "decision": "MANUEL",
            "reason": "HÃ¸j prioritet krÃ¦ver manuel behandling.",
        }

    return {
        "decision": "AUTO",
        "reason": "Ikke hÃ¸j prioritet â€“ kan hÃ¥ndteres automatisk.",
    }


# -------------------------
# DEMO / SELF-TEST
# -------------------------

def main() -> None:
    examples = [
        {
            "type": "ekstern",
            "afdeling": "IT",
            "prioritet": "HÃ¸j",
            "beskrivelse": "Systemet er nede.",
        },
        {
            "type": "intern",
            "afdeling": "HR",
            "prioritet": "Lav",
            "beskrivelse": "SpÃ¸rgsmÃ¥l til ferie.",
        },
    ]

    print("\nðŸ§  Product core â€“ first decision rule\n")

    for i, example in enumerate(examples, start=1):
        result = decide(example)
        print(f"Sag {i}: {result['decision']} â€“ {result['reason']}")

    print()


if __name__ == "__main__":
    main()
